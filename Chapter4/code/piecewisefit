import numpy as np

points = np.array([[ -1.4683000758467482, -3.6948838397506325],
                   [ 1.77861565029704, -2.694779805442293],
                   [ -0.5963741108117389, -3.0884526681406475],
                   [ 1.7596831301557714, -2.932304725720429],
                   [ 1.9474729536308333, -2.457716251879881],
                   [ 1.496629530336325, -3.5766857422832508],
                   [ -1.1834176698826235, -3.464839373702473],
                   [ -0.36541357323849244, -3.8760307681662747],
                   [ 1.2242072938397732, -4.372437346337634],
                   [ 0.8576861935650788, -5.076674147420546],
                   [ -0.8866714266745772, -3.1872822919994133],
                   [ 1.2308870112803048, -3.712344124338633],
                   [ 1.7417241218999169, -3.056790233956967],
                   [ 1.321354895153949, -3.738926185317262],
                   [ -0.05466537677059957, -3.9716201206122195],
                   [ -1.026157848892157, -2.953277733393328],
                   [ -1.993378529361952, -4.314576417078651],
                   [ -0.8621353221163242, -3.0576994181830406],
                   [ -0.6759016734926151, -2.8768392664199323],
                   [ 0.45038639116732204, -4.673612785968086],
                   [ 0.8304372904108819, -5.427775828125893],
                   [ 0.47254210157617216, -4.271706827435632],
                   [ -0.008338424950017576, -4.406860781682103],
                   [ 1.3184581879811659, -4.143576551506015],
                   [ 0.12641755955821665, -4.653397774875193],
                   [ 0.4242240064828833, -4.805371383119558],
                   [ -0.5073470054108413, -3.866482169367287],
                   [ 1.1999971449861628, -4.613816794271869],
                   [ 1.3044149313253879, -4.070793586014549],
                   [ -0.2764535910648469, -3.4463803623574907],
                   [ -1.1855447875374727, -3.109505352874356],
                   [ -0.01658070086862784, -4.282778012309419],
                   [ -0.205940941839029, -3.549910275707815],
                   [ -1.024989654421578, -2.6237599546653176],
                   [ -0.7555976668801665, -2.9782556662309503],
                   [ 0.04205351252503764, -3.677473164396659],
                   [ 1.2935316261199596, -4.2475428895956755],
                   [ -1.0144748379704942, -3.2415343690253176],
                   [ -1.679989399298985, -4.785650125904262],
                   [ -1.035965666956237, -2.8462507878897303],
                   [ 0.3630249356170241, -4.482013163743327],
                   [ -0.8497752667476308, -2.3347809671276236],
                   [ -1.877811115564961, -5.5112458381976],
                   [ 0.08708648670805585, -4.296324496637734],
                   [ -1.53241339245709, -4.286231442588247],
                   [ -0.7287796773539812, -3.267205222938824],
                   [ 1.3774036191696934, -3.9810420682020675],
                   [ -1.9254566080870816, -5.14226584321321],
                   [ 0.13828212352802138, -4.000066902324123],
                   [ -0.09406193943531571, -4.0807046879519016],
                   [ -1.6263267946060216, -3.760791035051794],
                   [ 1.6337646395237098, -3.088353410723775],
                   [ -0.519057851411068, -3.409854214492113],
                   [ -0.4682898363299999, -3.304912695146471],
                   [ 0.041938372044474814, -3.7919306981785823],
                   [ -0.5061114409493355, -3.5936977763200493],
                   [ -1.28791480226614, -3.343630542228353],
                   [ -1.656474002042167, -4.325865855711734],
                   [ 1.3176469399721742, -4.522692493989991],
                   [ 1.731198461762613, -2.6562846936756093],
                   [ 0.2423952598529615, -3.886089314287422],
                   [ -0.09693559222275905, -3.780175236367644],
                   [ -0.7248174401355203, -2.8127268636305587],
                   [ -1.6260628533623058, -3.9059321607116297],
                   [ -0.32567520400963446, -3.1269040974177784],
                   [ -0.16027527325686508, -3.249590590886994],
                   [ 1.5207121816568425, -3.9436817352170026],
                   [ 1.7297229879941054, -2.397965811236888],
                   [ -0.09138218517241636, -3.6823972260438484],
                   [ 1.8302048599532146, -2.7046841810302618],
                   [ 0.9995964603218295, -5.391709689500442],
                   [ -1.467273970505559, -4.344268367932765],
                   [ -0.06078035216834499, -4.85371549566417],
                   [ -1.7380774844347808, -4.639389186165094],
                   [ -1.3596993827262676, -3.7431538591213696],
                   [ -0.21157929359607675, -3.2040369621700164],
                   [ 0.2829906703969445, -3.850890124850573],
                   [ -1.708403730272226, -4.524922515924287],
                   [ 0.13315492946374707, -4.0235351097084004],
                   [ 1.7896648886102948, -2.5881483048265213],
                   [ 0.16924755009871761, -3.837131660800567],
                   [ 0.33018057543020873, -4.336730396393881],
                   [ -0.6166121450292557, -3.3460619307127626],
                   [ 1.802801985573542, -2.521730143529557],
                   [ -0.02896949305449459, -3.917925652927217],
                   [ -1.7360604324460338, -4.670481113442352],
                   [ -1.7170831982054984, -4.387508221490876],
                   [ -1.5295847364634816, -3.1534660237305965],
                   [ -1.9087042033950725, -4.462541813696757],
                   [ 0.5827915356804194, -5.093310142147474],
                   [ 1.9787443346866902, -2.3720103905422025],
                   [ 1.7635402128490245, -2.495522532703525],
                   [ 1.9732195385684612, -2.145273999869245],
                   [ 1.755755584803531, -2.578390165008141],
                   [ -1.763569617850028, -4.6822736483315275],
                   [ -1.653956808569279, -4.732104945121194],
                   [ 1.49209143829653, -3.4859265703114883],
                   [ -1.3647366943726462, -3.691034310990699],
                   [ 1.9349126331204798, -1.9455474510830468],
                   [ 1.0229803193212033, -4.800778286386915]])
x = points[:,0]
y = points[:,1]

#rows of coefficient matrix associated to piecewise linear fit
piecewise_row = lambda x, cusps : np.concatenate(([1,x], [np.maximum(x-a, 0) for a in cusps]))

#Solve least squares fit
cusps=[-1,1]
A = np.array([piecewise_row(x[i], cusps) for i in range(len(x))])
f = np.linalg.lstsq(A,y,rcond=None)[0]

f3 = np.polyfit(x,y,3)

#RMS Error
print(np.sqrt(np.mean((y-A@f)**2)))
print(np.sqrt(np.mean((y-np.polyval(f3,x))**2)))


#Graph Scatterplot
import matplotlib.pyplot as plt
plt.ion()
plt.axis([-2.1, 2, -6, -1.5])
plt.scatter(x,y)
plt.show()

#Graph piecewise linear and cubic fits
t = np.linspace(-2,2,num = 100)
yhat = np.array([piecewise_row(x,cusps) for x in t])@f

functions = [yhat,np.poly1d(f3)(t)]
for g in functions:
    plt.axis([-2.1, 2, -6, -1.5])
    plt.scatter(x,y)
    plt.plot(t, g, 'r')
    plt.show()
